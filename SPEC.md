# SPEC — 기능 요구사항

> AI 릴레이 만화 MVP | `docs/사전 개발 기획안.md` 기반 산출
>

## 1. 에피소드 생성

- 에피소드 생성 시 **스타일 6종 프리셋** 중 하나 선택. 선택 후 변경 불가.
- **캐릭터 설명**을 텍스트로 입력. (외형, 의상, 성격 묘사)
- (선택) 제목, 한 줄 소개 입력.

## 2. 만화 칸 이미지 생성

- 한 칸당 **장면 설명**, **대사**, **표음**, **말풍선 위치**를 입력받아 **나노 바나나**로 1장 생성.
- 프롬프트 구성: **스타일 prefix** + **캐릭터 고정값** + (2칸부터) **이전 칸 이미지 레퍼런스** + **현재 칸 내용**.
- 프롬프트는 템플릿 파일로 관리한다. (예: `prompts/`)
- 생성 이미지는 세로 비율(예: 3:4 또는 9:16). Storage 저장 후 해당 칸에 URL 연결.
- 타임아웃 30초. 실패 시 "다시 생성" 버튼 노출, 기존 입력값 유지. 유해 콘텐츠 필터 시 "내용을 조금 수정해 주세요" 안내.

## 3. 멀티유저 콜라보 (턴제 릴레이)

- **콜라보 링크** 공유 시 링크로 진입한 사용자는 **닉네임만 입력**해 즉시 참여. 회원가입 없음.
- **턴제**: 현재 차례인 참여자만 입력창 활성화. 해당 참여자가 칸 생성 완료 시 다음 차례로 자동 이전.
- **Supabase Realtime**으로 칸 추가·참여자 목록·현재 턴 반영. 새로고침 없이 실시간 업데이트.
- 대기 중인 참여자에게 "OO님이 그리는 중…" 등 현재 턴 표시.

## 4. AI 이어쓰기

- **3칸 이상**일 때만 "AI에게 넘기기" 버튼 활성화.
- 클릭 시 스토리 생성용 LLM으로 남은 칸의 스토리(장면설명, 대사, 표음) 자동 생성 후, 칸별로 나노 바나나 호출해 이미지까지 완성.
- MVP에서 자동 생성 칸 수는 5~10칸 범위로 제한 검토.

## 5. 좋아요

- **칸 단위** 좋아요. 에피소드 총 좋아요 수는 칸별 합산으로 계산·표시.

## 6. SNS 공유

- 완성/미완성 무관 **언제든** "지금 공유하기" 제공.
- **세로 스트립 이미지** 다운로드 (PNG/JPEG). 파일명 예: `ai-relay-{episodeId}.png`.
- **고유 링크** 복사. 형식: `/e/{episodeId}` 또는 `https://도메인/c/{episodeId}`.
- (선택) QR 코드 표시.

## 7. 화면/상태

- 에피소드 생성 → 첫 칸 입력 → (콜라보 시) 대기실/차례 입력 → AI 이어쓰기(선택) → 공유.
- 공유 페이지에서 "나도 이어쓰기" CTA로 참여 플로우 진입 가능.

## 8. 예외·에러

- 이미지 생성 타임아웃/API 오류: 재시도 유도 및 토스트/인라인 메시지.
- 참여자 중도 이탈: 해당 턴 스킵 (MVP). 동시 수정 방지는 턴제 + Realtime 현재 턴 lock으로 보장.
